# Лабораторная работа 4 — «Каталог книг»

## Введение и цель
Цель работы — закрепить навыки работы с файловым вводом/выводом, ADO.NET и Entity Framework Core, а также с форматами XML и JSON. Студенты научатся импортировать данные из файлов, валидировать и сохранять их в базу данных, реализовывать CRUD-операции и экспортировать данные в разные форматы. Также рассматривается валидация XML по XSD и базовая JSON Schema-валидация.

## Описание задачи (общая концепция)
Необходимо создать консольное приложение **BookCatalog** для управления каталогом книг. Приложение должно уметь:
- Импортировать книги из CSV-файла `books.csv` и/или `books.xml`.
- Сохранять данные в базу данных (SQLite) через ADO.NET и EF Core.
- Реализовать CRUD-интерфейс для сущности Book (добавление, обновление, удаление, поиск).
- Экспортировать весь каталог в `books.json` и `books.xml`.
- Валидировать входящий XML через XSD-схему `books.xsd`. (JSON Schema — опция.)

Приложение должно логировать свои действия в `sync.log` (например, количество импортированных записей, ошибки валидации, действия при разрешении конфликтов).

## Структура данных — сущность Book
Рекомендуемая модель Book (C#):
```csharp
public class Book
{
    public string ISBN { get; set; } // PK
    public string Title { get; set; }
    public string Author { get; set; }
    public int? Year { get; set; }
    public int? Pages { get; set; }
}
```

## Задания
### Задание 1
**Цель:** импорт CSV → ADO.NET → экспорт в JSON/XML.
**Требуется:**
1. Реализовать парсер `books.csv` (формат: ISBN,Title,Author,Year,Pages). Учесть кавычки и запятые внутри полей.
2. Через ADO.NET вставить записи в таблицу `Books`. Использовать параметризованные запросы и обработку ошибок.
3. Сохранить весь список в `books.json` и `books.xml` (полная сериализация всех полей).
4. Записать лог с количеством успешно вставленных записей и перечнем ошибок в `sync.log`.

---
### Задание 2
**Цель:** перейти к EF Core и реализовать CRUD + синхронизацию.
**Требуется:**
1. Создать EF Core модель `Book` и `BooksContext`. Добавить миграции и применить их (также приложить SQL-скрипт).
2. Реализовать CRUD-операции (консольное меню или аргументы командной строки): добавить книгу, обновить поля, удалить по ISBN, найти по автору/части названия.
3. Реализовать команду "sync" — сравнить записи в БД и в `books.json`, вывести список различий: несоответствующие записи по ISBN, отсутствующие в одной из сторон.
4. При синхронизации предложить пользователю (или в конфигурации) стратегию разрешения конфликтов: skip / update_db / update_file. Логировать принятые решения.


---
### Задание 3*
**Цель:** валидация XML и продвинутая обработка дубликатов.
**Требуется:**
1. Реализовать импорт из `books.xml` с валидацией по XSD (`books.xsd`). Ошибки валидации нужно логировать и пропускать некорректные записи.
2. При обнаружении дубликата по ISBN выполнять одну из стратегий: skip / update / merge. Для merge нужно объединять непустые поля (например, если в одной записи нет Pages, взять значение из другой).
3. Логировать все операции (какая стратегия применялась, какие поля изменились).
4. Реализовать простой механизм отката: если импорт приводит к более чем N ошибкам (N — конфигурируемо), предложить откат изменений (транзакция или ручной откат).

---
### Задание 4*
**Цель:** обеспечить транзакционную надёжность и покрытие тестами.
**Требуется:**
1. Реализовать транзакционный импорт так, чтобы при неудаче экспортных/валидационных шагов изменения откатывались.
2. Логгировать успешные и неуспешные транзакции

---
